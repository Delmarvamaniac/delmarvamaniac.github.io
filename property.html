<!DOCTYPE html>
<html>
<head>
    <title>Property</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="./font-awesome/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>
<body>
    <script src="nav-load.js"></script>
    <script src="store-houses.js"></script>

    <div id="listingContainer" style="width: 100%;">
        <div style="background-color: rgb(58, 58, 58);">
            <div id="carousel" class="carousel slide w-50 mx-auto" data-bs-slide="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                      <img id="firstImage" src="/images/placeholderproperty.jpg" class="d-block w-100" alt="Property Image 1">
                    </div>
                    <div class="carousel-item">
                      <img src="/images/image2.jpg" class="d-block w-100" alt="Property Image 2">
                    </div>
                    <div class="carousel-item">
                      <img src="/images/image3.jpg" class="d-block w-100" alt="Property Image 3">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div id="savedAlert"></div>
        <div class="row mt-3 mb-2 mx-auto" style="width: 100%;">
            <div class="col-sm-1">
                <button id="savedStar" class="btn float-end">
                    <i id="star" class="fa fa-star-o" style="font-size: 36px;"></i>
                </button>
            </div>
            <div class="col-sm-3">
                <p id="price" class="fs-1 fw-bold">$XXX,XXX</p>
            </div>
            <div class="col-sm-1">
            </div>
            <div class="col-sm-1">
            </div>
            <div class="col-sm-3">
            </div>
            <div class="col-sm">
            </div>
        </div>
        <div class="row mt-3 mb-2 mx-auto" style="width: 100%;">
            <div class="col-sm-1"></div>
            <div class="col-sm-1">
                <i class="fa fa-bed" style="font-size: 36px;"></i>
                <p id="beds" class="fs-3 fw-bold" style="display: inline;"></p>
                <p>Bedrooms</p>
            </div>
            <div class="col-sm-1">
                <i class="fa fa-bath" style="font-size: 36px;"></i>
                <p id="baths" class="fs-3 fw-bold" style="display: inline;"></p>
                <p>Bathrooms</p>
            </div>
            <div class="col-sm-3">
                <i class="fa fa-square" style="font-size: 36px;"></i>
                <p id="area" class="fs-3 fw-bold" style="display: inline;"></p>
                <p>Area</p>
            </div>
            <div class="col-sm">
            </div>
        </div>

        <div class="row mb-2 mx-auto" style="width: 100%;">
            <div class="col"></div>
            <div class="col-sm-5">
                <p id="address" class="fs-3"></p>
            </div>
            <div class="col-sm-3"></div>
            <div class="col-sm-3"></div>

        </div>

        <div class="row mb-5 mx-auto" style="width: 100%;">
            <div class="col"></div>
            <div class="col-sm-2">
                <button type="button" class="btn btn-primary w-100 float-end" data-bs-toggle="modal" data-bs-target="#contactSellerModal">
                    <i class="fa fa-address-book-o me-3" aria-hidden="true"></i>Contact Seller
                  </button>            </div>
            <div class="col-sm-2">
                <button class="btn btn-outline-secondary w-100 float-end" data-bs-toggle="modal" data-bs-target="#FloorPlanModal">
                    <i class="fa fa-map-o me-3" aria-hidden="true"></i>View Floor Plan&lpar;s&rpar;
                  </button>
            </div>
            <div class="col-sm-2">
            </div>
            <div class="col-sm-5">
            </div>
        </div>

        <div class="row mb-5 mx-auto" style="width: 100%">
            <div class="col"></div>
            <div class="col-sm-8">
                <p id="description" class="fs-6">
                    Sample Text
                </p>
            </div>
            <div class="col-sm-3">
                <h3 class="text-center">Features</h3>
                <p id="features" class="fs-5  text-center">Features</p>
            </div>
        </div>
        <div class="row mb-3 mx-auto" style="width: 82%;">
            <div class="col-sm-3 w-100" style="background-color: rgb(231, 231, 231); border-radius: 10px;">
                <div class="row mx-auto mt-3 text-center">
                    <div class="col">
                        <p>Date Posted</p>
                        <p class="fs-5" id="datePosted"></p>
                    </div>
                    <div class="col">
                        <p>Seller Name</p>
                        <p class="fs-5" id="bottomName">John Doe</p>
                    </div>
                    <div class="col">
                        <p>Seller Email</p>
                        <p class="fs-5" id="bottomEmail">johndoe@example.com</p>
                    </div>
                    <div class="col">
                        <p>Seller Phone</p>
                        <p class="fs-5" id="bottomPhone">(123)-456-7890</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Begin Modals -->

    <div class="modal fade" id="FloorPlanModal" tabindex="-1" aria-labelledby="FloorPlanModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered"> <!-- modal-lg for bigger image -->
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="FloorPlanModalLabel">Floor Plan&lpar;s&rpar;</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <img src="/images/floorplan.jpg" alt="Floor Plan" class="img-fluid">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    <div class="modal fade" id="contactSellerModal" tabindex="-1" aria-labelledby="contactSellerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg"> <!-- large and centered -->
            <div class="modal-content">

              <div class="modal-header">
                <h5 class="modal-title" id="contactSellerModalLabel">Contact Seller</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body">
                <form id="contactForm" novalidate>
                  <!-- Salesperson Info (Static) -->
                  <div class="mb-4">
                    <h5>To: <strong><div id="SellerName">JOHN FRED DOE</div></strong></h5>
                    <h6>Phone: <div id="SellerPhone">905-517-7250</div></h6>
                    <h6>Email: <div id="SellerEmail">email@domain.ca</div></h6>
                  </div>

                  <!-- First Name and Last Name (Same Row) -->
                  <div class="row mb-3">
                    <div class="col">
                      <label for="firstName" class="form-label">First Name &nbsp;<strong>*</strong>&nbsp;</label>
                      <input type="text" class="form-control" id="firstName" placeholder="" aria-describedby="invalidFirst" required>
                      <div id="invalidFirst" class="invalid-feedback">
                        Please enter your first name.
                      </div>
                    </div>
                    <div class="col">
                      <label for="lastName" class="form-label">Last Name &nbsp;<strong>*</strong>&nbsp;</label>
                      <input type="text" class="form-control" id="lastName" placeholder="" aria-describedby="invalidLast" required>
                      <div id="invalidLast" class="invalid-feedback">
                        Please enter your last name.
                      </div>
                    </div>
                  </div>

                  <!-- Preferred Contact Method -->
                  <div class="mb-3">
                    <label class="form-label">Preferred Method of Contact</label>
                    <div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="contactMethod" id="contactEmail" value="Email" checked>
                        <label class="form-check-label" for="contactEmail">Email</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="contactMethod" id="contactPhone" value="Phone">
                        <label class="form-check-label" for="contactPhone">Phone</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="contactMethod" id="contactText" value="Text">
                        <label class="form-check-label" for="contactText">Text</label>
                      </div>
                    </div>
                  </div>

                  <!-- Email and Phone Number (Same Row) -->
                  <div class="row mb-3">
                    <div class="col">
                      <label for="email" class="form-label">Email &nbsp;<strong>*</strong>&nbsp;</label>
                      <input type="email" class="form-control" id="email" placeholder="" aria-describedby="invalidEmail" required>
                      <div id="invalidEmail" class="invalid-feedback">
                        Please enter a valid email.
                      </div>
                    </div>
                    <div class="col">
                      <label for="phone" class="form-label">Phone Number &nbsp;<strong>*</strong>&nbsp;</label>
                      <input type="tel" class="form-control" id="phone" placeholder="" aria-describedby="invalidPhone" required>
                      <div id="invalidPhone" class="invalid-feedback">
                        Please enter a phone number.
                      </div>
                    </div>
                  </div>

                  <!-- Message -->
                  <div class="mb-3">
                    <label for="message" class="form-label">Message &nbsp;<strong>*</strong>&nbsp;</label>
                    <textarea class="form-control" id="EmailWAddress" rows="4" aria-describedby="invalidMessage" required>I would appreciate more information about</textarea>
                    <div id="invalidMessage" class="invalid-feedback">
                      Please enter a message.
                    </div>
                  </div>

                  <!-- Booking a Showing -->
                  <div class="mb-3">
                    <div class="form-check mb-2">
                      <input class="form-check-input" type="checkbox" id="bookShowingCheckbox">
                      <label class="form-check-label" for="bookShowingCheckbox">
                        I wish to book a showing
                      </label>
                    </div>

                    <div id="ShowingDateTime" style="display: none;">
                      <div class="row">
                        <div class="col">
                          <input type="date" class="form-control mb-2" placeholder="">
                        </div>
                        <div class="col">
                          <input type="time" class="form-control mb-2" placeholder="">
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Submit Button -->
                  <button type="button" id="send" class="btn btn-primary w-100" data-bs-dismiss="modal" disabled>Send</button>
                </form>
              </div>
            </div>
          </div>
    </div>

    <!-- End Modals -->

    <!-- Load house data -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        const checkbox = document.getElementById('bookShowingCheckbox');
        const showingFields = document.getElementById('ShowingDateTime');

        checkbox.addEventListener('change', function() {
            if (checkbox.checked) {
            showingFields.style.display = 'block';
            } else {
            showingFields.style.display = 'none';
            }
        });
        });

        const url = new URL(window.location.href);
        const searchParams = new URLSearchParams(url.search);
        var listingContainer = document.getElementById('listingContainer');
        const id = parseInt(searchParams.get('id'));

        // fetch houses from local storage
        var houses = JSON.parse(localStorage.getItem("houses"));

        // show error if house id entered doesn't exist
        if (isNaN(id) || id < 0 || id > houses.length-1) {
            listingContainer.hidden = true;
            var center = document.createElement('center');
            center.className = "mb-3 mt-3";
            var h = document.createElement('h1');
            h.innerText = "Sorry! Property not found!"
            center.appendChild(h);
            document.body.appendChild(center);
        }

        var savedStar = document.getElementById('savedStar');
        var icon = savedStar.querySelector('#star');
        var savedAlert = document.getElementById('savedAlert');
        savedStar.addEventListener('click', function() {
            if (icon.className == 'fa fa-star-o') {
                icon.className = 'fa fa-star';
                // display alert showing the property has been saved
                savedAlert.innerHTML = `
                <div class="alert alert-success alert-dismissible" role="alert">
                    <div>Property saved.</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                `;
                houses[id].saved = true;
            } else {
                icon.className = 'fa fa-star-o';
                // clear saved alert if there is one
                savedAlert.innerHTML = '';
                houses[id].saved = false;
            }

            // update changes to local storage
            localStorage.setItem("houses", JSON.stringify(houses));
        });

        const house = houses[id];
        const thumbnail = "/images/" + house.thumbnail;
        const price = house.price.toLocaleString();
        const address = house.address + ", " + house.city + ", " + house.province;
        const beds = house.beds;
        const baths = house.baths;
        const area = house.area + "&nbsp;" + house.areaUnits;
        const saved = house.saved;
        const description = house.description;
        const features = house.features;
        const forSale = house.forSale;
        const date = house.date;
        const SellerName = house.SellerName;
        const SellerEmail = house.SellerEmail;
        const SellerPhone = house.SellerPhone;

        icon.className = saved ? 'fa fa-star' : 'fa fa-star-o';

        document.getElementById('EmailWAddress').value = `I would appreciate more information about ${address}.`;

        document.getElementById('firstImage').setAttribute('src', thumbnail);
        document.getElementById('price').innerText = "$" + price + (!forSale ? "/month" : "");
        document.getElementById('beds').innerHTML = "&nbsp;" + beds;
        document.getElementById('baths').innerHTML = "&nbsp;" + baths;
        document.getElementById('area').innerHTML = "&nbsp;" + area;
        document.getElementById('address').innerText = address;

        document.getElementById('SellerName').innerText = SellerName;
        document.getElementById('SellerEmail').innerText = SellerEmail;
        document.getElementById('SellerPhone').innerText = SellerPhone;

        document.getElementById('description').innerText = description;
        document.getElementById('features').innerText = features;
        document.getElementById('datePosted').innerText = date;
        document.getElementById('bottomName').innerText = SellerName;
        document.getElementById('bottomEmail').innerText = SellerEmail;
        document.getElementById('bottomPhone').innerText = SellerPhone;
    </script>

    <!-- Form validation script -->
    <script>
      $(document).ready(function() {
        const $form = $('#contactForm');
        console.log($form);
        const $send = $form.find('#send');
        console.log($send);
        const $fields = [$form.find('#firstName'), $form.find('#lastName'), $form.find('#email'), $form.find('#phone'), $form.find('#EmailWAddress')];
        console.log($fields);

        $form.on('input', function() {
          const valid = $form[0].checkValidity();
          $send.prop('disabled', !valid);
        });

        $fields.forEach((field) => {
          field.on('blur', function() {
            if (!field[0].checkValidity()) {
              field.addClass('is-invalid');
            } else {
              field.removeClass('is-invalid');
            }
          });
        });
      });
    </script>
</body>
</html>
